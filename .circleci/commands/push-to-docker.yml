description: "Build Docker Image and Push to Docker Hub"

steps:
  # DockerHub login
  - command: docker-login.yml

  # Build Docker Image
  - run:
      name: Build Docker Image
      command: |
        echo "üöÄ Building Docker image..."
        IMAGE_TAG=$(echo ${CIRCLE_TAG} | sed 's/^v//' | tr '/:*' '-' | tr '[:upper:]' '[:lower:]')
        echo "Using image tag: $IMAGE_TAG"
        docker build -t ${DOCKERHUB_REPO}:$IMAGE_TAG -t ${DOCKERHUB_REPO}:latest -f dockerfile .
        echo "‚úÖ Docker image built successfully."

        # Verify image
        docker images -a | grep ${DOCKERHUB_REPO} | grep $IMAGE_TAG && echo "‚úÖ Image exists" || (echo "‚ùå Image build failed" && exit 1)

  # Push Docker Image
  - run:
      name: Push Docker Image
      command: |
        echo "üöÄ Pushing Docker image to Docker Hub..."
        docker push ${DOCKERHUB_REPO}:$IMAGE_TAG
        docker push ${DOCKERHUB_REPO}:latest
        echo "‚úÖ Docker image pushed successfully."